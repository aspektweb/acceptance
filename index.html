<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shaxsiy Bunker | Arxiv</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: #e0e0e0; padding: 20px; display: flex; justify-content: center; }
        .bunker-card { width: 100%; max-width: 500px; background: #1e1e1e; padding: 25px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.5); }
        h2 { text-align: center; color: #bb86fc; }
        input, textarea, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 6px; border: 1px solid #333; background: #252525; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; margin-top: 10px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; background: #03dac6; color: #000; }
        button:hover { opacity: 0.8; }
        .item { background: #2c2c2c; padding: 15px; margin-top: 15px; border-radius: 8px; border-left: 4px solid #bb86fc; position: relative; }
        .item small { color: #888; font-size: 11px; }
        .del-btn { background: #cf6679; color: white; width: auto; padding: 5px 10px; font-size: 12px; position: absolute; right: 10px; top: 10px; }
        .media-content { max-width: 100%; margin-top: 10px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="bunker-card">
    <h2>ðŸ”’ Shaxsiy Bunker</h2>
    
    <input type="email" id="gmail" placeholder="Gmail manzilingiz">
    <input type="password" id="masterKey" placeholder="Master Kod (Ma'lumotlarni ochish uchun)">
    
    <hr style="border: 0.5px solid #333; margin: 20px 0;">

    <input type="text" id="title" placeholder="Sarlavha (masalan: Muhim sir)">
    <select id="type">
        <option value="text">Matnli qayd</option>
        <option value="media">Media (Rasm/Ovoz)</option>
    </select>
    
    <div id="contentArea">
        <textarea id="textContent" rows="3" placeholder="Xabarni yozing..."></textarea>
        <input type="file" id="fileInput" style="display:none;" accept="image/*,audio/*">
    </div>

    <button onclick="saveData()">Bunkerga saqlash</button>
    <button style="background: #bb86fc;" onclick="loadData()">Arxivni ko'rish</button>

    <div id="archive"></div>
</div>

<script>
    // Turiga qarab inputni o'zgartirish
    document.getElementById('type').addEventListener('change', (e) => {
        document.getElementById('textContent').style.display = e.target.value === 'text' ? 'block' : 'none';
        document.getElementById('fileInput').style.display = e.target.value === 'media' ? 'block' : 'none';
    });

    // Ma'lumotni saqlash
    async function saveData() {
        const gmail = document.getElementById('gmail').value;
        const key = document.getElementById('masterKey').value;
        const title = document.getElementById('title').value;
        const type = document.getElementById('type').value;
        let content = "";

        if (!gmail || !key) return alert("Gmail va Master Kodni kiriting!");

        if (type === 'text') {
            content = document.getElementById('textContent').value;
        } else {
            const file = document.getElementById('fileInput').files[0];
            if (!file) return alert("Faylni tanlang!");
            content = await new Promise(r => {
                const reader = new FileReader();
                reader.onload = () => r(reader.result);
                reader.readAsDataURL(file);
            });
        }

        // Shifrlash (AES)
        const encrypted = CryptoJS.AES.encrypt(content, key).toString();

        const entry = {
            id: Date.now(),
            gmail: gmail,
            title: title,
            type: type,
            data: encrypted,
            date: new Date().toLocaleString()
        };

        let storage = JSON.parse(localStorage.getItem('bunker_data') || '[]');
        storage.push(entry);
        localStorage.setItem('bunker_data', JSON.stringify(storage));
        
        alert("Shifrlangan holda saqlandi!");
        document.getElementById('title').value = "";
        document.getElementById('textContent').value = "";
    }

    // Ma'lumotlarni ochish
    function loadData() {
        const key = document.getElementById('masterKey').value;
        const gmail = document.getElementById('gmail').value;
        if (!key || !gmail) return alert("Gmail va Master Kodni kiriting!");

        const storage = JSON.parse(localStorage.getItem('bunker_data') || '[]');
        const archiveDiv = document.getElementById('archive');
        archiveDiv.innerHTML = "";

        storage.filter(item => item.gmail === gmail).forEach(item => {
            try {
                const bytes = CryptoJS.AES.decrypt(item.data, key);
                const decrypted = bytes.toString(CryptoJS.enc.Utf8);
                
                if (!decrypted) throw new Error();

                let htmlContent = item.type === 'text' ? `<p>${decrypted}</p>` : 
                    (decrypted.includes('image') ? `<img src="${decrypted}" class="media-content">` : `<audio controls src="${decrypted}"></audio>`);

                archiveDiv.innerHTML += `
                    <div class="item">
                        <button class="del-btn" onclick="deleteItem(${item.id})">O'chirish</button>
                        <strong>${item.title}</strong><br>
                        <small>${item.date}</small>
                        <div style="margin-top:10px;">${htmlContent}</div>
                    </div>
                `;
            } catch (e) {
                archiveDiv.innerHTML = "<p style='color:red;'>Kod noto'g'ri yoki ma'lumot buzilgan!</p>";
            }
        });
    }

    function deleteItem(id) {
        let storage = JSON.parse(localStorage.getItem('bunker_data') || '[]');
        storage = storage.filter(i => i.id !== id);
        localStorage.setItem('bunker_data', JSON.stringify(storage));
        loadData();
    }
</script>

</body>
</html>
